# Android Graphics æ¦‚å¿µåœ°å›¾

> æ¦‚å¿µçº§å­¦ä¹ è¿›åº¦è¿½è¸ªã€‚çŠ¶æ€ï¼šâœ… æŒæ¡ / ğŸ”„ è¿›è¡Œä¸­ / â³ å¾…å¼€å§‹

## æ¦‚å¿µä¾èµ–å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              åº”ç”¨å±‚                                          â”‚
â”‚   Canvas â”€â”€â”€ View System â”€â”€â”€ SurfaceView â”€â”€â”€ TextureView                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            å›¾å½¢ API å±‚                                       â”‚
â”‚   OpenGL ES â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€ EGL â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Vulkan                                â”‚
â”‚       â”‚                  â”‚                â”‚                                  â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚                          â”‚                                                   â”‚
â”‚                       Skia (HWUI)                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ç¼“å†²ç®¡ç†å±‚                                         â”‚
â”‚   BufferQueue â”€â”€â”€ GraphicBuffer â”€â”€â”€ Gralloc                                â”‚
â”‚       â”‚                                                                      â”‚
â”‚   Surface â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º SurfaceTexture                        â”‚
â”‚       â”‚                                    â”‚                                 â”‚
â”‚   ANativeWindow                        OES Texture                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           åˆæˆå±‚                                             â”‚
â”‚   SurfaceFlinger â”€â”€â”€ Layer â”€â”€â”€ Transaction                                  â”‚
â”‚       â”‚                                                                      â”‚
â”‚   VSync â”€â”€â”€ Choreographer                                                   â”‚
â”‚       â”‚                                                                      â”‚
â”‚   HWC (Hardware Composer)                                                   â”‚
â”‚       â”‚                                                                      â”‚
â”‚   Device Composition â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Client Composition                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           é©±åŠ¨å±‚                                             â”‚
â”‚   GPU Driver â”€â”€â”€ DRM/KMS â”€â”€â”€ Display Driver                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Phase 1: EGL åŸºç¡€ (Month 1-2)

| æ¦‚å¿µ | ä¸€å¥è¯è§£é‡Š | çŠ¶æ€ | Mastery |
|------|-----------|------|---------|
| EGL | è¿æ¥æ¸²æŸ“ APIï¼ˆGLES/Vulkanï¼‰ä¸åŸç”Ÿçª—å£ç³»ç»Ÿçš„æ¡¥æ¥å±‚ | ğŸ”„ | [egl.md](../../../learning-log/mastery/egl.md) |
| EGLDisplay | ä¸æ˜¾ç¤ºç³»ç»Ÿçš„è¿æ¥æŠ½è±¡ï¼ˆä¸æ˜¯ç‰©ç†æ˜¾ç¤ºå™¨ï¼‰ | âœ… | [egl.md](../../../learning-log/mastery/egl.md) |
| EGLSurface | æ¸²æŸ“ç›®æ ‡è¡¨é¢ï¼ˆçª—å£/ç¦»å±/Pixmapï¼‰ | ğŸ”„ | [egl.md](../../../learning-log/mastery/egl.md) |
| EGLContext | OpenGL ES çŠ¶æ€æœºå®¹å™¨ï¼Œå¿…é¡»ç»‘å®šåˆ°çº¿ç¨‹ | âœ… | [egl.md](../../../learning-log/mastery/egl.md) |
| EGLConfig | å¸§ç¼“å†²é…ç½®ï¼ˆé¢œè‰²/æ·±åº¦/æ¨¡æ¿ä½æ•°ï¼‰ | âœ… | [egl.md](../../../learning-log/mastery/egl.md) |
| EGLImage | è·¨è¿›ç¨‹/è·¨ API å…±äº«å›¾åƒèµ„æº | â³ | - |
| eglMakeCurrent | å°† Context ç»‘å®šåˆ°å½“å‰çº¿ç¨‹ | ğŸ”„ | [egl.md](../../../learning-log/mastery/egl.md) |
| shareContext | å¤š Context é—´å…±äº«èµ„æºçš„æœºåˆ¶ | âœ… | [egl.md](../../../learning-log/mastery/egl.md) |

### å…³é”®è¯¯è§£

- âŒ EGLContext å¯ä»¥åœ¨ä»»æ„çº¿ç¨‹ä½¿ç”¨ â†’ âœ… å¿…é¡»å…ˆ eglMakeCurrent ç»‘å®š
- âŒ å…±äº« Context å¯ä»¥å…±äº«æ‰€æœ‰ GL å¯¹è±¡ â†’ âœ… FBO/VAO ç­‰å®¹å™¨å¯¹è±¡ä¸èƒ½å…±äº«

---

## Phase 2: BufferQueue ä¸ Surface (Month 3-4)

| æ¦‚å¿µ | ä¸€å¥è¯è§£é‡Š | çŠ¶æ€ | Mastery |
|------|-----------|------|---------|
| BufferQueue | ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹çš„ç¼“å†²åŒºé˜Ÿåˆ— | â³ | - |
| GraphicBuffer | è·¨è¿›ç¨‹å…±äº«çš„å›¾å½¢ç¼“å†²åŒº | â³ | - |
| ANativeWindow | Native å±‚çª—å£æŠ½è±¡æ¥å£ | â³ | - |
| Surface | ANativeWindow çš„ Java/Native å®ç° | â³ | - |
| SurfaceTexture | å°† Surface å†…å®¹è½¬ä¸º GL çº¹ç†ï¼ˆOESï¼‰ | â³ | - |
| Fence | GPU/CPU åŒæ­¥åŸè¯­ | â³ | - |
| Gralloc | å›¾å½¢å†…å­˜åˆ†é…å™¨ HAL | â³ | - |
| dequeueBuffer | ç”Ÿäº§è€…è·å–ç©ºé—² Buffer | â³ | - |
| queueBuffer | ç”Ÿäº§è€…æäº¤ Buffer åˆ°é˜Ÿåˆ— | â³ | - |
| acquireBuffer | æ¶ˆè´¹è€…è·å–å¾…å¤„ç† Buffer | â³ | - |
| releaseBuffer | æ¶ˆè´¹è€…å½’è¿˜ Buffer | â³ | - |

### å…³é”®è¯¯è§£

- âŒ queueBuffer åå›¾åƒç«‹å³æ˜¾ç¤º â†’ âœ… å­˜åœ¨ 2-3 å¸§å»¶è¿Ÿ
- âŒ Triple Buffering ä¼šå¢åŠ å»¶è¿Ÿ â†’ âœ… å®ƒæ˜¯ä¸ºäº†å‡å°‘å¡é¡¿
- âŒ SurfaceTexture ä½¿ç”¨æ™®é€š 2D çº¹ç† â†’ âœ… å¿…é¡»ä½¿ç”¨ GL_TEXTURE_EXTERNAL_OES

---

## Phase 3: SurfaceFlinger (Month 5-7)

| æ¦‚å¿µ | ä¸€å¥è¯è§£é‡Š | çŠ¶æ€ | Mastery |
|------|-----------|------|---------|
| SurfaceFlinger | ç³»ç»ŸåˆæˆæœåŠ¡ï¼Œç®¡ç†æ‰€æœ‰ Layer çš„æ˜¾ç¤º | â³ | - |
| Layer | åˆæˆå±‚æŠ½è±¡ï¼ˆBufferLayer/ColorLayerï¼‰ | â³ | - |
| VSync | å‚ç›´åŒæ­¥ä¿¡å· | â³ | - |
| VSYNC-app | åº”ç”¨å±‚å¼€å§‹æ¸²æŸ“çš„ä¿¡å· | â³ | - |
| VSYNC-sf | SurfaceFlinger å¼€å§‹åˆæˆçš„ä¿¡å· | â³ | - |
| Choreographer | åº”ç”¨å±‚ VSync è°ƒåº¦å™¨ | â³ | - |
| HWC | ç¡¬ä»¶åˆæˆå™¨ HAL | â³ | - |
| Device Composition | ç¡¬ä»¶åˆæˆï¼ˆDPU overlayï¼‰ | â³ | - |
| Client Composition | GPU åˆæˆ | â³ | - |
| Transaction | åŸå­æäº¤æœºåˆ¶ | â³ | - |
| CompositionEngine | åˆæˆå¼•æ“ | â³ | - |

### å…³é”®è¯¯è§£

- âŒ æ‰€æœ‰ Layer éƒ½ç”± GPU åˆæˆ â†’ âœ… HWC ä¼˜å…ˆä½¿ç”¨ç¡¬ä»¶åˆæˆ
- âŒ VSync åªæœ‰ä¸€ä¸ª â†’ âœ… Android æœ‰ VSYNC-app/VSYNC-sf/VSYNC-display

---

## Phase 4: ç¡¬ä»¶åŠ é€Ÿä¸ HWUI (Month 8-9)

| æ¦‚å¿µ | ä¸€å¥è¯è§£é‡Š | çŠ¶æ€ | Mastery |
|------|-----------|------|---------|
| HWUI | ç¡¬ä»¶åŠ é€Ÿ UI æ¸²æŸ“åº“ | â³ | - |
| RenderThread | UI æ¸²æŸ“ä¸“ç”¨çº¿ç¨‹ | â³ | - |
| DisplayList | æ¸²æŸ“å‘½ä»¤è®°å½• | â³ | - |
| RenderNode | æ¸²æŸ“æ ‘èŠ‚ç‚¹ | â³ | - |
| RecordingCanvas | è®°å½•ç»˜åˆ¶å‘½ä»¤çš„ Canvas | â³ | - |
| Skia | 2D å›¾å½¢å¼•æ“ | â³ | - |
| SkiaGL | Skia çš„ OpenGL åç«¯ | â³ | - |
| SkiaVulkan | Skia çš„ Vulkan åç«¯ | â³ | - |

### å…³é”®è¯¯è§£

- âŒ å¼€å¯ç¡¬ä»¶åŠ é€Ÿåæ‰€æœ‰ View éƒ½ç”¨ GPU æ¸²æŸ“ â†’ âœ… æŸäº›æ“ä½œä¼š fallback åˆ°è½¯ä»¶æ¸²æŸ“
- âŒ LAYER_TYPE_HARDWARE æ€»èƒ½æå‡æ€§èƒ½ â†’ âœ… ä¸å½“ä½¿ç”¨ä¼šå¢åŠ å†…å­˜å ç”¨

---

## Phase 5: Vulkan (Month 10-11)

| æ¦‚å¿µ | ä¸€å¥è¯è§£é‡Š | çŠ¶æ€ | Mastery |
|------|-----------|------|---------|
| VkInstance | Vulkan å®ä¾‹ | â³ | - |
| VkPhysicalDevice | ç‰©ç†è®¾å¤‡æŠ½è±¡ | â³ | - |
| VkDevice | é€»è¾‘è®¾å¤‡ | â³ | - |
| VkQueue | å‘½ä»¤é˜Ÿåˆ— | â³ | - |
| VkCommandBuffer | å‘½ä»¤ç¼“å†²åŒº | â³ | - |
| VkSwapchain | äº¤æ¢é“¾ | â³ | - |
| VkRenderPass | æ¸²æŸ“é€šé“ | â³ | - |
| VkPipeline | å›¾å½¢ç®¡çº¿çŠ¶æ€å¯¹è±¡ï¼ˆé¢„ç¼–è¯‘ï¼‰ | â³ | - |
| VkDescriptorSet | èµ„æºæè¿°ç¬¦é›†åˆ | â³ | - |
| VkFence | CPU-GPU åŒæ­¥ | â³ | - |
| VkSemaphore | Queue é—´åŒæ­¥ | â³ | - |
| Pipeline Barrier | å‘½ä»¤é—´åŒæ­¥/å†…å­˜å±éšœ | â³ | - |

### å…³é”®è¯¯è§£

- âŒ Vulkan æ¯” OpenGL ES æ›´å¿« â†’ âœ… ä¼˜åŠ¿åœ¨äºå¯é¢„æµ‹æ€§å’Œ CPU å¼€é”€
- âŒ Vulkan ä¸éœ€è¦åŒæ­¥ï¼ŒGPU ä¼šè‡ªåŠ¨å¤„ç† â†’ âœ… åŒæ­¥å®Œå…¨ç”±å¼€å‘è€…è´Ÿè´£

---

## ç»Ÿè®¡

| Phase | æ€»æ¦‚å¿µæ•° | âœ… æŒæ¡ | ğŸ”„ è¿›è¡Œä¸­ | â³ å¾…å¼€å§‹ |
|-------|---------|--------|----------|----------|
| Phase 1: EGL | 8 | 4 | 3 | 1 |
| Phase 2: BufferQueue | 11 | 0 | 0 | 11 |
| Phase 3: SurfaceFlinger | 11 | 0 | 0 | 11 |
| Phase 4: HWUI | 8 | 0 | 0 | 8 |
| Phase 5: Vulkan | 12 | 0 | 0 | 12 |
| **æ€»è®¡** | **50** | **4** | **3** | **43** |

