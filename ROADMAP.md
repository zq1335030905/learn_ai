# Android å›¾å½¢ç³»ç»Ÿä¸æ¸²æŸ“æ¡†æ¶å­¦ä¹ è·¯çº¿å›¾

> ç›®æ ‡ï¼šä¸€å¹´å†…ç³»ç»ŸæŒæ¡ Android å›¾å½¢ç³»ç»Ÿã€SurfaceFlingerã€EGLã€OpenGL ES/Vulkan æ¸²æŸ“ç®¡çº¿
> å‰ç½®æ¡ä»¶ï¼šç†Ÿæ‚‰ OpenGL æ¸²æŸ“ç®¡çº¿å’ŒåŸºæœ¬å›¾å½¢æ¸²æŸ“æ¦‚å¿µ

---

## ğŸ“Š çŸ¥è¯†ä¾èµ–å…³ç³»å›¾

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                    åº”ç”¨å±‚ (Application)                  â”‚
                    â”‚  Canvas API / View System / SurfaceView / TextureView   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           å›¾å½¢ API å±‚ (Graphics API)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   OpenGL ES     â”‚    â”‚     Vulkan      â”‚    â”‚      Skia (2Dæ¸²æŸ“å¼•æ“)       â”‚ â”‚
â”‚  â”‚  (çŠ¶æ€æœºæ¨¡å‹)    â”‚    â”‚  (æ˜¾å¼æ§åˆ¶æ¨¡å‹)  â”‚    â”‚   (Canvasåº•å±‚å®ç°/HWUI)      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                     â”‚                            â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚            EGL (æ¡¥æ¥å±‚)              â”‚
        â”‚   è¿æ¥æ¸²æŸ“APIä¸åŸç”Ÿçª—å£ç³»ç»Ÿçš„æ¥å£     â”‚
        â”‚   EGLDisplay / EGLSurface / EGLContextâ”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          BufferQueue æœºåˆ¶                                       â”‚
â”‚                    Producer â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Consumer                               â”‚
â”‚                (App/Camera)              (SurfaceFlinger)                       â”‚
â”‚                                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚   â”‚   Surface            â”‚              â”‚   SurfaceTexture     â”‚                â”‚
â”‚   â”‚   (native_window)    â”‚              â”‚   (GLçº¹ç†æ¶ˆè´¹è€…)      â”‚                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         SurfaceFlinger              â”‚
        â”‚   (ç³»ç»Ÿåˆæˆå™¨ / çª—å£ç®¡ç†æ ¸å¿ƒ)         â”‚
        â”‚                                     â”‚
        â”‚   â€¢ Layer ç®¡ç†                      â”‚
        â”‚   â€¢ VSync ä¿¡å·åˆ†å‘                  â”‚
        â”‚   â€¢ åˆæˆç­–ç•¥ (GPU/HWC)              â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    Hardware Composer (HWC)          â”‚
        â”‚    ç¡¬ä»¶åˆæˆå™¨æŠ½è±¡å±‚                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         æ˜¾ç¤ºé©±åŠ¨ / GPU é©±åŠ¨          â”‚
        â”‚         Gralloc / DRM/KMS          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—“ï¸ å­¦ä¹ é˜¶æ®µè§„åˆ’ (12ä¸ªæœˆ)

### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€å·©å›ºä¸ EGL æ·±å…¥ (Month 1-2)

#### æ ¸å¿ƒæ¦‚å¿µ

| æ¦‚å¿µ | æè¿° | é‡è¦ç¨‹åº¦ |
|------|------|----------|
| **EGLDisplay** | ä¸ç‰©ç†æ˜¾ç¤ºè®¾å¤‡çš„è¿æ¥æŠ½è±¡ | â­â­â­â­â­ |
| **EGLSurface** | æ¸²æŸ“ç›®æ ‡è¡¨é¢ï¼ˆçª—å£/ç¦»å±/Pixmapï¼‰ | â­â­â­â­â­ |
| **EGLContext** | OpenGL ES çŠ¶æ€æœºå®¹å™¨ | â­â­â­â­â­ |
| **EGLConfig** | å¸§ç¼“å†²é…ç½®ï¼ˆé¢œè‰²/æ·±åº¦/æ¨¡æ¿ä½æ•°ï¼‰ | â­â­â­â­ |
| **EGLImage** | è·¨è¿›ç¨‹/è·¨APIå…±äº«å›¾åƒèµ„æº | â­â­â­â­ |
| **EGL Extensions** | OES_imageã€ANDROID_native_fence ç­‰ | â­â­â­ |

#### å­¦ä¹ ç›®æ ‡
- [ ] ç†è§£ EGL ä½œä¸º"æ¡¥æ¥å±‚"çš„è§’è‰²å®šä½
- [ ] æŒæ¡ EGL åˆå§‹åŒ–å®Œæ•´æµç¨‹
- [ ] ç†è§£ EGLContext ä¸çº¿ç¨‹ç»‘å®šæœºåˆ¶
- [ ] æŒæ¡å¤š Context èµ„æºå…±äº«ï¼ˆshareContextï¼‰
- [ ] ç†è§£ EGLImage çš„è·¨è¿›ç¨‹å…±äº«æœºåˆ¶

#### æœ€å°å®éªŒ

```cpp
// å®éªŒ1: æ‰‹å†™ EGL åˆå§‹åŒ–æµç¨‹ (ä¸ä½¿ç”¨å°è£…åº“)
// ç›®æ ‡: ç†è§£æ¯ä¸ªæ­¥éª¤çš„æ„ä¹‰

// 1. è·å– Display
EGLDisplay display = eglGetDisplay(EGL_DEFAULT_DISPLAY);

// 2. åˆå§‹åŒ– EGL
EGLint major, minor;
eglInitialize(display, &major, &minor);

// 3. é€‰æ‹©é…ç½®
EGLint configAttribs[] = {
    EGL_RENDERABLE_TYPE, EGL_OPENGL_ES3_BIT,
    EGL_SURFACE_TYPE, EGL_WINDOW_BIT,
    EGL_RED_SIZE, 8,
    EGL_GREEN_SIZE, 8,
    EGL_BLUE_SIZE, 8,
    EGL_ALPHA_SIZE, 8,
    EGL_DEPTH_SIZE, 24,
    EGL_NONE
};
EGLConfig config;
EGLint numConfigs;
eglChooseConfig(display, configAttribs, &config, 1, &numConfigs);

// 4. åˆ›å»º Surface
EGLSurface surface = eglCreateWindowSurface(display, config, nativeWindow, NULL);

// 5. åˆ›å»º Context
EGLint contextAttribs[] = { EGL_CONTEXT_CLIENT_VERSION, 3, EGL_NONE };
EGLContext context = eglCreateContext(display, config, EGL_NO_CONTEXT, contextAttribs);

// 6. ç»‘å®š Context
eglMakeCurrent(display, surface, surface, context);
```

```cpp
// å®éªŒ2: å¤šçº¿ç¨‹ Context å…±äº«å®éªŒ
// ç›®æ ‡: ç†è§£ Context çº¿ç¨‹ç»‘å®šè§„åˆ™å’Œèµ„æºå…±äº«æœºåˆ¶

// ä¸»çº¿ç¨‹åˆ›å»ºå…±äº« Context
EGLContext sharedContext = eglCreateContext(display, config, mainContext, contextAttribs);

// å­çº¿ç¨‹ä¸­
std::thread renderThread([&]() {
    // å¿…é¡»åœ¨ä½¿ç”¨å‰ç»‘å®šåˆ°å½“å‰çº¿ç¨‹
    eglMakeCurrent(display, EGL_NO_SURFACE, EGL_NO_SURFACE, sharedContext);
    
    // ç°åœ¨å¯ä»¥è®¿é—®ä¸» Context åˆ›å»ºçš„çº¹ç†ç­‰èµ„æº
    // ä½† FBOã€VAO ç­‰å®¹å™¨å¯¹è±¡ä¸èƒ½å…±äº«ï¼
});
```

#### æ¨èèµ„æ–™

| ç±»å‹ | èµ„æ–™ | è¯´æ˜ |
|------|------|------|
| å®˜æ–¹æ–‡æ¡£ | [EGL 1.5 Specification](https://registry.khronos.org/EGL/) | æƒå¨å‚è€ƒ |
| ä¹¦ç± | ã€ŠOpenGL ES 3.0 Programming Guideã€‹Ch3 | EGL ä¸“ç«  |
| æºç  | AOSP `frameworks/native/opengl/libs/EGL/` | å®ç°ç»†èŠ‚ |
| åšå®¢ | Android Graphics Architecture ç³»åˆ— | Google å®˜æ–¹æ¶æ„æ–‡æ¡£ |

---

### ç¬¬äºŒé˜¶æ®µï¼šBufferQueue ä¸ Surface ä½“ç³» (Month 3-4)

#### æ ¸å¿ƒæ¦‚å¿µ

| æ¦‚å¿µ | æè¿° | é‡è¦ç¨‹åº¦ |
|------|------|----------|
| **BufferQueue** | ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹çš„ç¼“å†²åŒºé˜Ÿåˆ— | â­â­â­â­â­ |
| **GraphicBuffer** | è·¨è¿›ç¨‹å…±äº«çš„å›¾å½¢ç¼“å†²åŒº | â­â­â­â­â­ |
| **ANativeWindow** | native å±‚çª—å£æŠ½è±¡æ¥å£ | â­â­â­â­â­ |
| **Surface** | ANativeWindow çš„ Java/Native å®ç° | â­â­â­â­â­ |
| **SurfaceTexture** | å°† Surface å†…å®¹è½¬ä¸º GL çº¹ç† | â­â­â­â­â­ |
| **Fence** | åŒæ­¥åŸè¯­ï¼ˆGPU/CPUåŒæ­¥ï¼‰ | â­â­â­â­ |
| **Gralloc** | å›¾å½¢å†…å­˜åˆ†é…å™¨ HAL | â­â­â­â­ |

#### BufferQueue çŠ¶æ€æœº

```
                          dequeueBuffer()
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                     â”‚
    â–¼                                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”  queueBuffer()   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  acquireBuffer()  â”Œâ”€â”´â”€â”€â”€â”€â”€â”
â”‚ FREE  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ QUEUED â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚ACQUIREDâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”˜
    â–²                                                     â”‚
    â”‚                   releaseBuffer()                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Buffer ç”Ÿå‘½å‘¨æœŸï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Producer (App)                  Consumer (SurfaceFlinger)       â”‚
â”‚                                                                  â”‚
â”‚  1. dequeueBuffer() â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º è·å–ç©ºé—² Buffer                   â”‚
â”‚  2. æ¸²æŸ“å†…å®¹åˆ° Buffer                                            â”‚
â”‚  3. queueBuffer() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º æäº¤ Buffer åˆ°é˜Ÿåˆ—                â”‚
â”‚                                                                  â”‚
â”‚                                4. acquireBuffer() â—„â”€â”€â”€â”€â”€ è·å–å¾…æ˜¾ç¤ºâ”‚
â”‚                                5. åˆæˆ/æ˜¾ç¤º                      â”‚
â”‚                                6. releaseBuffer() â”€â”€â”€â”€â–º å½’è¿˜Bufferâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å­¦ä¹ ç›®æ ‡
- [ ] ç†è§£ BufferQueue çš„ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹
- [ ] æŒæ¡ GraphicBuffer çš„å†…å­˜ç®¡ç†å’Œè·¨è¿›ç¨‹å…±äº«
- [ ] ç†è§£ Surface ä¸ ANativeWindow çš„å…³ç³»
- [ ] æŒæ¡ SurfaceTexture çš„å·¥ä½œåŸç†ï¼ˆå¤–éƒ¨çº¹ç† OESï¼‰
- [ ] ç†è§£ Fence åŒæ­¥æœºåˆ¶ï¼ˆAcquire Fence / Release Fenceï¼‰
- [ ] äº†è§£ Triple Buffering çš„æ„ä¹‰

#### æœ€å°å®éªŒ

```java
// å®éªŒ3: SurfaceTexture + Camera å®æ—¶é¢„è§ˆ
// ç›®æ ‡: ç†è§£ SurfaceTexture ä½œä¸º GL çº¹ç†æ¶ˆè´¹è€…çš„æœºåˆ¶

public class CameraPreviewRenderer implements GLSurfaceView.Renderer {
    private SurfaceTexture surfaceTexture;
    private int oesTextureId;
    
    @Override
    public void onSurfaceCreated(GL10 gl, EGLConfig config) {
        // 1. åˆ›å»º OES çº¹ç†
        int[] textures = new int[1];
        GLES20.glGenTextures(1, textures, 0);
        oesTextureId = textures[0];
        
        GLES20.glBindTexture(GLES11Ext.GL_TEXTURE_EXTERNAL_OES, oesTextureId);
        GLES20.glTexParameteri(GLES11Ext.GL_TEXTURE_EXTERNAL_OES, 
            GLES20.GL_TEXTURE_MIN_FILTER, GLES20.GL_LINEAR);
        
        // 2. åˆ›å»º SurfaceTexture ç»‘å®šåˆ° OES çº¹ç†
        surfaceTexture = new SurfaceTexture(oesTextureId);
        
        // 3. å°† SurfaceTexture åŒ…è£…æˆ Surface ç»™ Camera
        Surface surface = new Surface(surfaceTexture);
        // camera.setPreviewSurface(surface);
    }
    
    @Override
    public void onDrawFrame(GL10 gl) {
        // 4. æ›´æ–°çº¹ç†ï¼ˆä» BufferQueue è·å–æœ€æ–°å¸§ï¼‰
        surfaceTexture.updateTexImage();
        
        // 5. è·å–çº¹ç†å˜æ¢çŸ©é˜µ
        float[] matrix = new float[16];
        surfaceTexture.getTransformMatrix(matrix);
        
        // 6. ä½¿ç”¨ OES çº¹ç†æ¸²æŸ“
        // æ³¨æ„: å¿…é¡»ä½¿ç”¨ samplerExternalOES è€Œé sampler2D
    }
}
```

```cpp
// å®éªŒ4: Native å±‚ä½¿ç”¨ ANativeWindow 
// ç›®æ ‡: ç†è§£ Surface åœ¨ Native å±‚çš„ä½¿ç”¨

void renderToSurface(JNIEnv* env, jobject surface) {
    // 1. è·å– ANativeWindow
    ANativeWindow* window = ANativeWindow_fromSurface(env, surface);
    
    // 2. è®¾ç½®ç¼“å†²åŒºæ ¼å¼
    ANativeWindow_setBuffersGeometry(window, width, height, AHARDWAREBUFFER_FORMAT_R8G8B8A8_UNORM);
    
    // 3. é”å®šç¼“å†²åŒºè¿›è¡Œè½¯ä»¶æ¸²æŸ“
    ANativeWindow_Buffer buffer;
    ANativeWindow_lock(window, &buffer, NULL);
    
    // 4. ç›´æ¥å†™å…¥åƒç´ æ•°æ®
    uint32_t* pixels = (uint32_t*)buffer.bits;
    for (int y = 0; y < buffer.height; y++) {
        for (int x = 0; x < buffer.width; x++) {
            pixels[y * buffer.stride + x] = 0xFFFF0000; // Red
        }
    }
    
    // 5. è§£é”å¹¶æäº¤
    ANativeWindow_unlockAndPost(window);
    
    ANativeWindow_release(window);
}
```

#### æ¨èèµ„æ–™

| ç±»å‹ | èµ„æ–™ | è¯´æ˜ |
|------|------|------|
| å®˜æ–¹æ–‡æ¡£ | [Android Graphics Architecture](https://source.android.com/docs/core/graphics) | å¿…è¯» |
| æºç  | `frameworks/native/libs/gui/BufferQueue*.cpp` | æ ¸å¿ƒå®ç° |
| æºç  | `frameworks/native/libs/gui/Surface.cpp` | Surface å®ç° |
| è§†é¢‘ | Google I/O "Graphics Performance" ç³»åˆ— | æ¶æ„æ¦‚è§ˆ |

---

### ç¬¬ä¸‰é˜¶æ®µï¼šSurfaceFlinger æ·±å…¥ (Month 5-7)

#### æ ¸å¿ƒæ¦‚å¿µ

| æ¦‚å¿µ | æè¿° | é‡è¦ç¨‹åº¦ |
|------|------|----------|
| **SurfaceFlinger** | ç³»ç»ŸåˆæˆæœåŠ¡ | â­â­â­â­â­ |
| **Layer** | åˆæˆå±‚æŠ½è±¡ | â­â­â­â­â­ |
| **VSync** | å‚ç›´åŒæ­¥ä¿¡å· | â­â­â­â­â­ |
| **Choreographer** | åº”ç”¨å±‚ VSync è°ƒåº¦ | â­â­â­â­ |
| **HWC (Hardware Composer)** | ç¡¬ä»¶åˆæˆå™¨ HAL | â­â­â­â­â­ |
| **Client Composition** | GPU åˆæˆ | â­â­â­â­ |
| **Device Composition** | ç¡¬ä»¶åˆæˆ | â­â­â­â­ |
| **Transaction** | åŸå­æäº¤æœºåˆ¶ | â­â­â­â­ |

#### SurfaceFlinger æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            SurfaceFlinger è¿›ç¨‹                               â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    ä¸»çº¿ç¨‹ (Main Thread)                              â”‚   â”‚
â”‚  â”‚  â€¢ å¤„ç† Transaction                                                 â”‚   â”‚
â”‚  â”‚  â€¢ ç®¡ç† Layer æ ‘                                                    â”‚   â”‚
â”‚  â”‚  â€¢ å¤„ç† Binder è°ƒç”¨                                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                        â”‚
â”‚                                    â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    åˆæˆçº¿ç¨‹ (CompositionEngine)                      â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚   â”‚ preCompose   â”‚                   â”‚     åˆæˆç­–ç•¥å†³ç­–           â”‚  â”‚   â”‚
â”‚  â”‚   â”‚ å‡†å¤‡Layeræ•°æ® â”‚                   â”‚                           â”‚  â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚  Layerèƒ½HWCåˆæˆ? â”€â”€â”€â”€â”€â”   â”‚  â”‚   â”‚
â”‚  â”‚          â”‚                           â”‚         â”‚            â”‚   â”‚  â”‚   â”‚
â”‚  â”‚          â–¼                           â”‚         â–¼            â–¼   â”‚  â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚   â”‚
â”‚  â”‚   â”‚ HWC validate â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚Device    â”‚  â”‚Client  â”‚â”‚  â”‚   â”‚
â”‚  â”‚   â”‚ è¯¢é—®HWCèƒ½åŠ›   â”‚                   â”‚  â”‚Compose   â”‚  â”‚Compose â”‚â”‚  â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚  â”‚(ç¡¬ä»¶åˆæˆ) â”‚  â”‚(GPU)   â”‚â”‚  â”‚   â”‚
â”‚  â”‚          â”‚                           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚   â”‚
â”‚  â”‚          â–¼                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                  â”‚   â”‚
â”‚  â”‚   â”‚ HWC present  â”‚                                                  â”‚   â”‚
â”‚  â”‚   â”‚ æäº¤åˆ°æ˜¾ç¤º    â”‚                                                  â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    VSync çº¿ç¨‹ (EventThread)                          â”‚   â”‚
â”‚  â”‚  â€¢ æ¥æ”¶ HWC VSync ä¸­æ–­                                               â”‚   â”‚
â”‚  â”‚  â€¢ åˆ†å‘ VSync ä¿¡å·ç»™ Choreographer                                   â”‚   â”‚
â”‚  â”‚  â€¢ æ§åˆ¶å¸§ç‡ (VSYNC-app / VSYNC-sf)                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ¸²æŸ“æµæ°´çº¿æ—¶åº

```
           VSync-app                          VSync-sf                        VSync-display
              â”‚                                  â”‚                                  â”‚
Frame N:      â”‚                                  â”‚                                  â”‚
              â–¼                                  â”‚                                  â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚                                  â”‚
    â”‚   App æ¸²æŸ“      â”‚                          â”‚                                  â”‚
    â”‚  (16.6msé¢„ç®—)   â”‚                          â”‚                                  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚                                  â”‚
             â”‚ queueBuffer()                     â”‚                                  â”‚
             â–¼                                   â–¼                                  â”‚
             â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
             â”‚                         â”‚ SurfaceFlinger  â”‚                         â”‚
             â”‚                         â”‚   åˆæˆå¤„ç†      â”‚                         â”‚
             â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
             â”‚                                  â”‚                                   â”‚
             â”‚                                  â”‚ present()                        â–¼
             â”‚                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚                                                            â”‚  æ˜¾ç¤º Frame N â”‚
             â”‚                                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
Frame N+1:   â–¼ (å¼€å§‹ä¸‹ä¸€å¸§)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   App æ¸²æŸ“      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å…¸å‹å»¶è¿Ÿ: æ¸²æŸ“å®Œæˆåˆ°æ˜¾ç¤º â‰ˆ 2-3 ä¸ª VSync å‘¨æœŸ (33-50ms @60Hz)
```

#### å­¦ä¹ ç›®æ ‡
- [ ] ç†è§£ SurfaceFlinger çš„è¿›ç¨‹æ¶æ„å’Œçº¿ç¨‹æ¨¡å‹
- [ ] æŒæ¡ Layer çš„ç±»å‹ï¼ˆBufferLayer/ColorLayer/ContainerLayerï¼‰
- [ ] ç†è§£ VSync ä¿¡å·çš„äº§ç”Ÿå’Œåˆ†å‘æœºåˆ¶
- [ ] æŒæ¡ HWC åˆæˆç­–ç•¥ï¼ˆDevice vs Client Compositionï¼‰
- [ ] ç†è§£ Transaction çš„åŸå­æäº¤æœºåˆ¶
- [ ] æŒæ¡å¸§è°ƒåº¦ä¸ Jank åˆ†ææ–¹æ³•

#### æœ€å°å®éªŒ

```bash
# å®éªŒ5: ä½¿ç”¨ dumpsys åˆ†æ SurfaceFlinger çŠ¶æ€
# ç›®æ ‡: ç†è§£è¿è¡Œæ—¶ Layer ç»“æ„å’ŒåˆæˆçŠ¶æ€

# æŸ¥çœ‹å½“å‰ Layer æ ‘
adb shell dumpsys SurfaceFlinger --list

# æŸ¥çœ‹è¯¦ç»†åˆæˆä¿¡æ¯
adb shell dumpsys SurfaceFlinger

# å…³é”®ä¿¡æ¯:
# - Layer åç§°å’Œç±»å‹
# - Buffer é˜Ÿåˆ—çŠ¶æ€
# - åˆæˆç±»å‹ (DEVICE/CLIENT)
# - Display ä¿¡æ¯
```

```bash
# å®éªŒ6: ä½¿ç”¨ Systrace/Perfetto åˆ†ææ¸²æŸ“æµæ°´çº¿
# ç›®æ ‡: ç†è§£å¸§æ¸²æŸ“çš„å®Œæ•´æ—¶åº

# 1. æŠ“å– trace
adb shell perfetto -c - --txt -o /data/misc/perfetto-traces/trace.pb <<EOF
buffers {
    size_kb: 63488
}
data_sources {
    config {
        name: "linux.ftrace"
        ftrace_config {
            ftrace_events: "sched/*"
            ftrace_events: "freq/*"
            ftrace_events: "gpu/*"
            ftrace_events: "sync/*"
            atrace_categories: "gfx"
            atrace_categories: "view"
            atrace_categories: "wm"
            atrace_apps: "*"
        }
    }
}
duration_ms: 5000
EOF

# 2. å¯¼å‡ºå¹¶ä½¿ç”¨ Perfetto UI åˆ†æ
adb pull /data/misc/perfetto-traces/trace.pb
# ä¸Šä¼ åˆ° ui.perfetto.dev

# å…³é”®è§‚å¯Ÿç‚¹:
# - Choreographer#doFrame
# - SurfaceFlinger VSYNC-sf
# - HWC validate/present
# - dequeueBuffer/queueBuffer æ—¶åº
```

```cpp
// å®éªŒ7: ä½¿ç”¨ SurfaceControl API (Android 10+)
// ç›®æ ‡: ç†è§£ Transaction æœºåˆ¶

#include <android/surface_control.h>

void createSurfaceControl(ANativeWindow* parentWindow) {
    // 1. åˆ›å»º SurfaceControl
    ASurfaceControl* surfaceControl = ASurfaceControl_createFromWindow(
        parentWindow, "MyLayer");
    
    // 2. åˆ›å»º Transaction
    ASurfaceTransaction* transaction = ASurfaceTransaction_create();
    
    // 3. è®¾ç½® Layer å±æ€§
    ASurfaceTransaction_setVisibility(transaction, surfaceControl, ASURFACE_TRANSACTION_VISIBILITY_SHOW);
    ASurfaceTransaction_setZOrder(transaction, surfaceControl, 100);
    
    // è®¾ç½®å‡ ä½•å˜æ¢
    ASurfaceTransaction_setPosition(transaction, surfaceControl, 100, 100);
    ASurfaceTransaction_setScale(transaction, surfaceControl, 2.0f, 2.0f);
    
    // 4. åŸå­æäº¤
    ASurfaceTransaction_apply(transaction);
    
    ASurfaceTransaction_delete(transaction);
}
```

#### æ¨èèµ„æ–™

| ç±»å‹ | èµ„æ–™ | è¯´æ˜ |
|------|------|------|
| æºç  | `frameworks/native/services/surfaceflinger/` | æ ¸å¿ƒæœåŠ¡ |
| æºç  | `frameworks/native/services/surfaceflinger/CompositionEngine/` | åˆæˆå¼•æ“ |
| æ–‡æ¡£ | [Android Graphics HAL](https://source.android.com/docs/core/graphics/implement) | HWC å®ç°æŒ‡å— |
| å·¥å…· | Perfetto/Systrace | æ€§èƒ½åˆ†æå¿…å¤‡ |
| åšå®¢ | Gityuan SurfaceFlinger ç³»åˆ— | ä¸­æ–‡æ·±åº¦è§£æ |

---

### ç¬¬å››é˜¶æ®µï¼šç¡¬ä»¶åŠ é€Ÿä¸ HWUI (Month 8-9)

#### æ ¸å¿ƒæ¦‚å¿µ

| æ¦‚å¿µ | æè¿° | é‡è¦ç¨‹åº¦ |
|------|------|----------|
| **HWUI** | ç¡¬ä»¶åŠ é€Ÿ UI æ¸²æŸ“åº“ | â­â­â­â­â­ |
| **RenderThread** | UI æ¸²æŸ“ä¸“ç”¨çº¿ç¨‹ | â­â­â­â­â­ |
| **DisplayList** | æ¸²æŸ“å‘½ä»¤è®°å½• | â­â­â­â­ |
| **RenderNode** | æ¸²æŸ“æ ‘èŠ‚ç‚¹ | â­â­â­â­ |
| **Skia** | 2D å›¾å½¢å¼•æ“ | â­â­â­â­â­ |
| **SkiaGL/SkiaVulkan** | Skia GPU åç«¯ | â­â­â­â­ |

#### ç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Application è¿›ç¨‹                               â”‚
â”‚                                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                     Main Thread (UI Thread)                      â”‚  â”‚
â”‚   â”‚                                                                  â”‚  â”‚
â”‚   â”‚   View.onDraw(Canvas)                                           â”‚  â”‚
â”‚   â”‚         â”‚                                                        â”‚  â”‚
â”‚   â”‚         â–¼                                                        â”‚  â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚  â”‚
â”‚   â”‚   â”‚ RecordingCanvas  â”‚  è®°å½•ç»˜åˆ¶å‘½ä»¤ (ä¸æ‰§è¡Œ)                     â”‚  â”‚
â”‚   â”‚   â”‚ (DisplayListå½•åˆ¶) â”‚                                          â”‚  â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚  â”‚
â”‚   â”‚            â”‚                                                     â”‚  â”‚
â”‚   â”‚            â–¼                                                     â”‚  â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚  â”‚
â”‚   â”‚   â”‚   RenderNode     â”‚  ä¿å­˜ DisplayList                         â”‚  â”‚
â”‚   â”‚   â”‚   (æ¸²æŸ“æ ‘èŠ‚ç‚¹)    â”‚                                          â”‚  â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚  â”‚
â”‚   â”‚            â”‚ sync (åŒæ­¥æ¸²æŸ“æ ‘)                                   â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                â”‚                                                        â”‚
â”‚                â–¼                                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                     Render Thread                                â”‚  â”‚
â”‚   â”‚                                                                  â”‚  â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚  â”‚
â”‚   â”‚   â”‚ RenderPipeline   â”‚â”€â”€â”€â–ºâ”‚     Skia         â”‚                  â”‚  â”‚
â”‚   â”‚   â”‚ (GL/Vulkané€‰æ‹©)   â”‚    â”‚  (å®é™…ç»˜åˆ¶æ‰§è¡Œ)   â”‚                  â”‚  â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚  â”‚
â”‚   â”‚                                    â”‚                             â”‚  â”‚
â”‚   â”‚                                    â–¼                             â”‚  â”‚
â”‚   â”‚                           GPU å‘½ä»¤æäº¤                           â”‚  â”‚
â”‚   â”‚                                    â”‚                             â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                        â”‚                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚ queueBuffer()
                                         â–¼
                                  SurfaceFlinger
```

#### å­¦ä¹ ç›®æ ‡
- [ ] ç†è§£è½¯ä»¶æ¸²æŸ“ä¸ç¡¬ä»¶åŠ é€Ÿæ¸²æŸ“çš„åŒºåˆ«
- [ ] æŒæ¡ DisplayList çš„å½•åˆ¶ä¸å›æ”¾æœºåˆ¶
- [ ] ç†è§£ RenderThread çš„èŒè´£å’Œç”Ÿå‘½å‘¨æœŸ
- [ ] æŒæ¡ Skia çš„æ¶æ„å’Œ GPU åç«¯é€‰æ‹©
- [ ] ç†è§£ View.setLayerType() çš„åŸç†
- [ ] æŒæ¡è¿‡åº¦ç»˜åˆ¶åˆ†æå’Œä¼˜åŒ–

#### æœ€å°å®éªŒ

```java
// å®éªŒ8: å¯¹æ¯”è½¯ä»¶/ç¡¬ä»¶æ¸²æŸ“æ€§èƒ½
// ç›®æ ‡: ç†è§£ç¡¬ä»¶åŠ é€Ÿçš„æ”¶ç›Š

public class RenderingBenchmarkView extends View {
    private Paint paint = new Paint();
    private Path complexPath = new Path();
    
    public RenderingBenchmarkView(Context context) {
        super(context);
        // æ„å»ºå¤æ‚è·¯å¾„
        for (int i = 0; i < 1000; i++) {
            complexPath.addCircle(
                (float) Math.random() * 500,
                (float) Math.random() * 500,
                10, Path.Direction.CW);
        }
    }
    
    @Override
    protected void onDraw(Canvas canvas) {
        long start = System.nanoTime();
        
        // ç»˜åˆ¶å¤æ‚å†…å®¹
        canvas.drawPath(complexPath, paint);
        
        long duration = System.nanoTime() - start;
        Log.d("Benchmark", "onDraw: " + (duration / 1000000.0) + "ms" +
              " | isHardwareAccelerated: " + canvas.isHardwareAccelerated());
    }
}

// æµ‹è¯•:
// 1. é»˜è®¤ç¡¬ä»¶åŠ é€Ÿ
// view.setLayerType(View.LAYER_TYPE_HARDWARE, null);
// 
// 2. å¼ºåˆ¶è½¯ä»¶æ¸²æŸ“
// view.setLayerType(View.LAYER_TYPE_SOFTWARE, null);
```

```bash
# å®éªŒ9: åˆ†æ RenderThread å¸§è€—æ—¶
# ç›®æ ‡: ç†è§£ UI çº¿ç¨‹ä¸æ¸²æŸ“çº¿ç¨‹çš„åä½œ

# å¼€å¯ GPU æ¸²æŸ“åˆ†æ
adb shell setprop debug.hwui.profile true
adb shell setprop debug.hwui.profile.maxframes 128

# è§‚å¯Ÿ Profile GPU Rendering æ¡å½¢å›¾
# è“è‰²: UI çº¿ç¨‹å¤„ç†æ—¶é—´
# ç´«è‰²: æ¸²æŸ“çº¿ç¨‹å‡†å¤‡æ—¶é—´
# çº¢è‰²: æ‰§è¡Œ GPU å‘½ä»¤æ—¶é—´
# é»„è‰²: CPU ç­‰å¾… GPU å®Œæˆ
```

#### æ¨èèµ„æ–™

| ç±»å‹ | èµ„æ–™ | è¯´æ˜ |
|------|------|------|
| æºç  | `frameworks/base/libs/hwui/` | HWUI å®ç° |
| æºç  | `external/skia/` | Skia å¼•æ“ |
| æ–‡æ¡£ | [Skia Documentation](https://skia.org/docs/) | Skia å®˜æ–¹æ–‡æ¡£ |
| è§†é¢‘ | Android Dev Summit "Rendering" | æ¸²æŸ“æ¶æ„æ¼”è¿› |

---

### ç¬¬äº”é˜¶æ®µï¼šVulkan æ¸²æŸ“ç®¡çº¿ (Month 10-11)

#### æ ¸å¿ƒæ¦‚å¿µ

| æ¦‚å¿µ | æè¿° | é‡è¦ç¨‹åº¦ |
|------|------|----------|
| **VkInstance** | Vulkan å®ä¾‹ | â­â­â­â­â­ |
| **VkPhysicalDevice** | ç‰©ç†è®¾å¤‡æŠ½è±¡ | â­â­â­â­â­ |
| **VkDevice** | é€»è¾‘è®¾å¤‡ | â­â­â­â­â­ |
| **VkQueue** | å‘½ä»¤é˜Ÿåˆ— | â­â­â­â­â­ |
| **VkCommandBuffer** | å‘½ä»¤ç¼“å†²åŒº | â­â­â­â­â­ |
| **VkSwapchain** | äº¤æ¢é“¾ | â­â­â­â­â­ |
| **VkRenderPass** | æ¸²æŸ“é€šé“ | â­â­â­â­â­ |
| **VkPipeline** | å›¾å½¢ç®¡çº¿çŠ¶æ€å¯¹è±¡ | â­â­â­â­â­ |
| **VkDescriptorSet** | èµ„æºæè¿°ç¬¦é›†åˆ | â­â­â­â­â­ |
| **Synchronization** | ä¿¡å·é‡/æ …æ /äº‹ä»¶ | â­â­â­â­â­ |

#### OpenGL ES vs Vulkan å¯¹æ¯”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        OpenGL ES (çŠ¶æ€æœºæ¨¡å‹)                                 â”‚
â”‚                                                                              â”‚
â”‚   glBindTexture(...)  â”€â”                                                     â”‚
â”‚   glBindBuffer(...)   â”€â”¼â”€â”€â–º å…¨å±€çŠ¶æ€ä¿®æ”¹ â”€â”€â–º é©±åŠ¨éšå¼ç®¡ç†                      â”‚
â”‚   glDrawArrays(...)   â”€â”˜         â”‚                                           â”‚
â”‚                                  â–¼                                           â”‚
â”‚                        é©±åŠ¨å†…éƒ¨: çŠ¶æ€éªŒè¯ã€å‘½ä»¤ç”Ÿæˆã€èµ„æºåŒæ­¥                   â”‚
â”‚                        (å¯¹å¼€å‘è€…é€æ˜ï¼Œä½†æœ‰è¿è¡Œæ—¶å¼€é”€)                          â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Vulkan (æ˜¾å¼æ§åˆ¶æ¨¡å‹)                                  â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  åˆå§‹åŒ–é˜¶æ®µ (ä¸€æ¬¡æ€§)                                                  â”‚   â”‚
â”‚   â”‚  â€¢ åˆ›å»º VkInstance/VkDevice                                         â”‚   â”‚
â”‚   â”‚  â€¢ åˆ›å»º VkRenderPass (æŒ‡å®š attachment æ ¼å¼/load/store æ“ä½œ)          â”‚   â”‚
â”‚   â”‚  â€¢ åˆ›å»º VkPipeline (å®Œæ•´ç®¡çº¿çŠ¶æ€ï¼Œé¢„ç¼–è¯‘)                             â”‚   â”‚
â”‚   â”‚  â€¢ åˆ›å»º VkDescriptorSetLayout (èµ„æºç»‘å®šå¸ƒå±€)                         â”‚   â”‚
â”‚   â”‚  â€¢ åˆ†é… VkCommandBuffer                                             â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                         â”‚
â”‚                                    â–¼                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  æ¸²æŸ“å¾ªç¯ (æ¯å¸§)                                                     â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â”‚  vkBeginCommandBuffer()                                             â”‚   â”‚
â”‚   â”‚       â”‚                                                              â”‚   â”‚
â”‚   â”‚       â–¼                                                              â”‚   â”‚
â”‚   â”‚  vkCmdBeginRenderPass()  â”€â–º æŒ‡å®š Framebuffer                        â”‚   â”‚
â”‚   â”‚  vkCmdBindPipeline()     â”€â–º ç»‘å®šé¢„åˆ›å»ºçš„ç®¡çº¿                         â”‚   â”‚
â”‚   â”‚  vkCmdBindDescriptorSets() â”€â–º ç»‘å®šèµ„æº                              â”‚   â”‚
â”‚   â”‚  vkCmdDraw()             â”€â–º å½•åˆ¶ç»˜åˆ¶å‘½ä»¤                             â”‚   â”‚
â”‚   â”‚  vkCmdEndRenderPass()                                               â”‚   â”‚
â”‚   â”‚       â”‚                                                              â”‚   â”‚
â”‚   â”‚       â–¼                                                              â”‚   â”‚
â”‚   â”‚  vkEndCommandBuffer()                                               â”‚   â”‚
â”‚   â”‚       â”‚                                                              â”‚   â”‚
â”‚   â”‚       â–¼                                                              â”‚   â”‚
â”‚   â”‚  vkQueueSubmit()  â”€â–º æäº¤åˆ°é˜Ÿåˆ—æ‰§è¡Œ (æ˜¾å¼åŒæ­¥)                        â”‚   â”‚
â”‚   â”‚                                                                      â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Vulkan åŒæ­¥æœºåˆ¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Vulkan åŒæ­¥åŸè¯­                                    â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚  Fence (CPU-GPU åŒæ­¥)                                                 â”‚ â”‚
â”‚   â”‚  â€¢ CPU ç­‰å¾… GPU å®Œæˆç‰¹å®šæ“ä½œ                                          â”‚ â”‚
â”‚   â”‚  â€¢ vkWaitForFences() - CPU é˜»å¡ç­‰å¾…                                   â”‚ â”‚
â”‚   â”‚                                                                       â”‚ â”‚
â”‚   â”‚  ä½¿ç”¨åœºæ™¯: ç¡®ä¿å¸§æ¸²æŸ“å®Œæˆåå†é‡ç”¨ CommandBuffer                        â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚  Semaphore (Queue-Queue åŒæ­¥)                                         â”‚ â”‚
â”‚   â”‚  â€¢ GPU é˜Ÿåˆ—é—´åŒæ­¥                                                     â”‚ â”‚
â”‚   â”‚  â€¢ Binary: æœ‰ä¿¡å·/æ— ä¿¡å· çŠ¶æ€                                         â”‚ â”‚
â”‚   â”‚  â€¢ Timeline: å¸¦è®¡æ•°å™¨çš„ä¿¡å·é‡ (Vulkan 1.2)                            â”‚ â”‚
â”‚   â”‚                                                                       â”‚ â”‚
â”‚   â”‚  ä½¿ç”¨åœºæ™¯: å›¾åƒä» swapchain è·å–å â†’ æ¸²æŸ“å®Œæˆå â†’ present              â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚  Pipeline Barrier (å‘½ä»¤é—´åŒæ­¥)                                        â”‚ â”‚
â”‚   â”‚  â€¢ åŒä¸€ CommandBuffer å†…çš„æ‰§è¡Œä¾èµ–                                    â”‚ â”‚
â”‚   â”‚  â€¢ Memory Barrier: å†…å­˜å¯è§æ€§                                         â”‚ â”‚
â”‚   â”‚  â€¢ Image Layout Transition: å›¾åƒå¸ƒå±€è½¬æ¢                              â”‚ â”‚
â”‚   â”‚                                                                       â”‚ â”‚
â”‚   â”‚  ä½¿ç”¨åœºæ™¯: å†™å…¥çº¹ç†å â†’ é‡‡æ ·è¯¥çº¹ç†                                     â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å­¦ä¹ ç›®æ ‡
- [ ] ç†è§£ Vulkan çš„è®¾è®¡å“²å­¦ï¼ˆæ˜¾å¼ vs éšå¼ï¼‰
- [ ] æŒæ¡ Vulkan åˆå§‹åŒ–æµç¨‹
- [ ] ç†è§£ RenderPass å’Œ Subpass çš„æ¦‚å¿µ
- [ ] æŒæ¡ Pipeline åˆ›å»ºå’ŒçŠ¶æ€ç®¡ç†
- [ ] ç†è§£ DescriptorSet çš„èµ„æºç»‘å®šæœºåˆ¶
- [ ] æŒæ¡åŒæ­¥åŸè¯­çš„æ­£ç¡®ä½¿ç”¨
- [ ] ç†è§£ Memory Management å’Œ Buffer/Image åˆ›å»º

#### æœ€å°å®éªŒ

```cpp
// å®éªŒ10: Vulkan ä¸‰è§’å½¢æ¸²æŸ“ (Android)
// ç›®æ ‡: ç†è§£ Vulkan å®Œæ•´æ¸²æŸ“æµç¨‹

// ç®€åŒ–çš„åˆå§‹åŒ–ä¼ªä»£ç 
void initVulkan(ANativeWindow* window) {
    // 1. åˆ›å»º Instance
    VkInstanceCreateInfo instanceInfo = {
        .sType = VK_STRUCTURE_TYPE_INSTANCE_CREATE_INFO,
        .pApplicationInfo = &appInfo,
        .enabledExtensionCount = extensionCount,
        .ppEnabledExtensionNames = extensions,  // VK_KHR_surface, VK_KHR_android_surface
    };
    vkCreateInstance(&instanceInfo, nullptr, &instance);
    
    // 2. åˆ›å»º Surface (Android ç‰¹å®š)
    VkAndroidSurfaceCreateInfoKHR surfaceInfo = {
        .sType = VK_STRUCTURE_TYPE_ANDROID_SURFACE_CREATE_INFO_KHR,
        .window = window,
    };
    vkCreateAndroidSurfaceKHR(instance, &surfaceInfo, nullptr, &surface);
    
    // 3. é€‰æ‹©ç‰©ç†è®¾å¤‡å’Œé˜Ÿåˆ—æ—
    // 4. åˆ›å»ºé€»è¾‘è®¾å¤‡
    // 5. åˆ›å»º Swapchain
    // 6. åˆ›å»º RenderPass
    // 7. åˆ›å»º Pipeline
    // 8. åˆ›å»º Framebuffers
    // 9. åˆ†é… CommandBuffers
    
    // ... å®Œæ•´ä»£ç çº¦ 500-1000 è¡Œ
}

void drawFrame() {
    // 1. è·å–ä¸‹ä¸€ä¸ªå¯ç”¨å›¾åƒ
    uint32_t imageIndex;
    vkAcquireNextImageKHR(device, swapchain, UINT64_MAX, 
        imageAvailableSemaphore, VK_NULL_HANDLE, &imageIndex);
    
    // 2. ç­‰å¾…å‰ä¸€å¸§å®Œæˆ
    vkWaitForFences(device, 1, &inFlightFence, VK_TRUE, UINT64_MAX);
    vkResetFences(device, 1, &inFlightFence);
    
    // 3. å½•åˆ¶å‘½ä»¤
    vkResetCommandBuffer(commandBuffer, 0);
    
    VkCommandBufferBeginInfo beginInfo = { ... };
    vkBeginCommandBuffer(commandBuffer, &beginInfo);
    
    VkRenderPassBeginInfo renderPassInfo = {
        .sType = VK_STRUCTURE_TYPE_RENDER_PASS_BEGIN_INFO,
        .renderPass = renderPass,
        .framebuffer = framebuffers[imageIndex],
        .renderArea = { .offset = {0, 0}, .extent = swapchainExtent },
        .clearValueCount = 1,
        .pClearValues = &clearColor,
    };
    vkCmdBeginRenderPass(commandBuffer, &renderPassInfo, VK_SUBPASS_CONTENTS_INLINE);
    vkCmdBindPipeline(commandBuffer, VK_PIPELINE_BIND_POINT_GRAPHICS, pipeline);
    vkCmdDraw(commandBuffer, 3, 1, 0, 0);
    vkCmdEndRenderPass(commandBuffer);
    
    vkEndCommandBuffer(commandBuffer);
    
    // 4. æäº¤å‘½ä»¤
    VkSubmitInfo submitInfo = {
        .sType = VK_STRUCTURE_TYPE_SUBMIT_INFO,
        .waitSemaphoreCount = 1,
        .pWaitSemaphores = &imageAvailableSemaphore,
        .pWaitDstStageMask = &waitStages,
        .commandBufferCount = 1,
        .pCommandBuffers = &commandBuffer,
        .signalSemaphoreCount = 1,
        .pSignalSemaphores = &renderFinishedSemaphore,
    };
    vkQueueSubmit(graphicsQueue, 1, &submitInfo, inFlightFence);
    
    // 5. Present
    VkPresentInfoKHR presentInfo = {
        .sType = VK_STRUCTURE_TYPE_PRESENT_INFO_KHR,
        .waitSemaphoreCount = 1,
        .pWaitSemaphores = &renderFinishedSemaphore,
        .swapchainCount = 1,
        .pSwapchains = &swapchain,
        .pImageIndices = &imageIndex,
    };
    vkQueuePresentKHR(presentQueue, &presentInfo);
}
```

#### æ¨èèµ„æ–™

| ç±»å‹ | èµ„æ–™ | è¯´æ˜ |
|------|------|------|
| å®˜æ–¹ | [Vulkan Specification](https://registry.khronos.org/vulkan/) | æƒå¨å‚è€ƒ |
| æ•™ç¨‹ | [Vulkan Tutorial](https://vulkan-tutorial.com/) | å…¥é—¨é¦–é€‰ |
| ä¹¦ç± | ã€ŠVulkan Programming Guideã€‹ | ç³»ç»Ÿå­¦ä¹  |
| ç¤ºä¾‹ | [Khronos Vulkan Samples](https://github.com/KhronosGroup/Vulkan-Samples) | å®˜æ–¹ç¤ºä¾‹ |
| ç¤ºä¾‹ | [Android Vulkan Samples](https://github.com/googlesamples/vulkan-basic-samples) | Android ä¸“ç”¨ |
| éªŒè¯å±‚ | Vulkan Validation Layers | å¼€å‘å¿…å¤‡ |

---

### ç¬¬å…­é˜¶æ®µï¼šç»¼åˆå®è·µä¸æ€§èƒ½ä¼˜åŒ– (Month 12)

#### ç»¼åˆå®éªŒé¡¹ç›®

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å®éªŒé¡¹ç›®: å¤šçª—å£è§†é¢‘æ’­æ”¾å™¨                                â”‚
â”‚                                                                             â”‚
â”‚   æ¶‰åŠçŸ¥è¯†ç‚¹:                                                                â”‚
â”‚   â€¢ EGL å¤š Context ç®¡ç†                                                     â”‚
â”‚   â€¢ SurfaceTexture æ¥æ”¶ MediaCodec è§£ç è¾“å‡º                                 â”‚
â”‚   â€¢ BufferQueue ç”Ÿäº§è€…æ¶ˆè´¹è€…åè°ƒ                                            â”‚
â”‚   â€¢ OpenGL ES / Vulkan æ¸²æŸ“                                                 â”‚
â”‚   â€¢ SurfaceView vs TextureView é€‰æ‹©                                        â”‚
â”‚   â€¢ å¸§åŒæ­¥ä¸éŸ³è§†é¢‘åŒæ­¥                                                       â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     å®éªŒé¡¹ç›®: è‡ªå®šä¹‰åˆæˆå™¨                                    â”‚
â”‚                                                                             â”‚
â”‚   æ¶‰åŠçŸ¥è¯†ç‚¹:                                                                â”‚
â”‚   â€¢ ä½¿ç”¨ ASurfaceControl åˆ›å»º Layer å±‚çº§                                    â”‚
â”‚   â€¢ å®ç°è‡ªå®šä¹‰çª—å£åŠ¨ç”»                                                       â”‚
â”‚   â€¢ Transaction æ‰¹é‡æäº¤                                                    â”‚
â”‚   â€¢ HWC åˆæˆç­–ç•¥è°ƒè¯•                                                        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ€§èƒ½åˆ†æå·¥å…·æ¸…å•

| å·¥å…· | ç”¨é€” | é‡è¦ç¨‹åº¦ |
|------|------|----------|
| **Perfetto** | ç³»ç»Ÿçº§ Trace åˆ†æ | â­â­â­â­â­ |
| **Android GPU Inspector** | GPU æ€§èƒ½åˆ†æ | â­â­â­â­â­ |
| **RenderDoc** | GPU å¸§è°ƒè¯• | â­â­â­â­ |
| **Snapdragon Profiler** | é«˜é€š GPU åˆ†æ | â­â­â­â­ |
| **Mali Graphics Debugger** | ARM GPU åˆ†æ | â­â­â­â­ |
| **dumpsys gfxinfo** | å¸§ç»Ÿè®¡ä¿¡æ¯ | â­â­â­ |
| **dumpsys SurfaceFlinger** | åˆæˆçŠ¶æ€åˆ†æ | â­â­â­ |

---

## âš ï¸ å¸¸è§è¯¯è§£ä¸åç›´è§‰ç‚¹

### 1. BufferQueue ç›¸å…³

#### âŒ è¯¯è§£: "queueBuffer åå›¾åƒç«‹å³æ˜¾ç¤º"
#### âœ… äº‹å®: å­˜åœ¨ 2-3 å¸§å»¶è¿Ÿ
```
queueBuffer() â†’ è¿›å…¥ BufferQueue â†’ SurfaceFlinger ä¸‹ä¸ª VSYNC å–èµ° 
â†’ åˆæˆ â†’ ä¸‹ä¸ª VSYNC æ˜¾ç¤º

å®é™…å»¶è¿Ÿ = 2-3 ä¸ª VSync å‘¨æœŸ â‰ˆ 33-50ms @60Hz
```

#### âŒ è¯¯è§£: "Triple Buffering ä¼šå¢åŠ å»¶è¿Ÿ"
#### âœ… äº‹å®: Triple Buffering æ˜¯ä¸ºäº†å‡å°‘å¡é¡¿ï¼Œä¸æ˜¯å¢åŠ å»¶è¿Ÿ
```
Double Buffer é—®é¢˜:
- å¦‚æœ App å¸§è€—æ—¶ > 16.6msï¼Œå¿…é¡»ç­‰ SurfaceFlinger é‡Šæ”¾ buffer
- å¯¼è‡´ App çº¿ç¨‹é˜»å¡åœ¨ dequeueBuffer

Triple Buffer è§£å†³:
- App æ€»æœ‰ buffer å¯ç”¨
- ä»£ä»·æ˜¯å†…å­˜å ç”¨å¢åŠ ï¼Œä½†å»¶è¿Ÿåœ¨æœ€åæƒ…å†µä¸‹ä¸å˜
```

### 2. EGL ç›¸å…³

#### âŒ è¯¯è§£: "EGLContext å¯ä»¥åœ¨ä»»æ„çº¿ç¨‹ä½¿ç”¨"
#### âœ… äº‹å®: EGLContext å¿…é¡»ç»‘å®šåˆ°å½“å‰çº¿ç¨‹
```cpp
// é”™è¯¯: åœ¨çº¿ç¨‹ A åˆ›å»º Contextï¼Œåœ¨çº¿ç¨‹ B ç›´æ¥ä½¿ç”¨
EGLContext ctx = eglCreateContext(...);  // Thread A
glBindTexture(...);  // Thread B - æœªå®šä¹‰è¡Œä¸ºï¼

// æ­£ç¡®: å…ˆç»‘å®šåˆ°å½“å‰çº¿ç¨‹
eglMakeCurrent(display, surface, surface, ctx);  // Thread B
glBindTexture(...);  // ç°åœ¨å¯ä»¥å®‰å…¨ä½¿ç”¨
```

#### âŒ è¯¯è§£: "å…±äº« Context å¯ä»¥å…±äº«æ‰€æœ‰ GL å¯¹è±¡"
#### âœ… äº‹å®: å®¹å™¨å¯¹è±¡ä¸èƒ½å…±äº«
```
å¯å…±äº«:
  âœ“ Texture
  âœ“ Buffer Object (VBO/EBO/UBO)
  âœ“ Renderbuffer
  âœ“ Shader/Program
  âœ“ Sampler
  âœ“ Sync Object

ä¸å¯å…±äº« (å®¹å™¨å¯¹è±¡):
  âœ— Framebuffer Object (FBO)
  âœ— Vertex Array Object (VAO)
  âœ— Transform Feedback Object
  âœ— Query Object
```

### 3. SurfaceFlinger ç›¸å…³

#### âŒ è¯¯è§£: "æ‰€æœ‰ Layer éƒ½ç”± GPU åˆæˆ"
#### âœ… äº‹å®: HWC ä¼˜å…ˆä½¿ç”¨ç¡¬ä»¶åˆæˆ
```
åˆæˆç­–ç•¥å†³ç­–è¿‡ç¨‹:
1. SurfaceFlinger å°†æ‰€æœ‰ Layer ä¿¡æ¯å‘é€ç»™ HWC
2. HWC è¿”å›æ¯ä¸ª Layer çš„åˆæˆç±»å‹:
   - DEVICE: ç¡¬ä»¶åˆæˆ (DPU overlay)
   - CLIENT: GPU åˆæˆ

ç¡¬ä»¶åˆæˆä¼˜åŠ¿:
- ä¸å ç”¨ GPU èµ„æº
- åŠŸè€—æ›´ä½
- æ— é¢å¤–å†…å­˜å¸¦å®½å¼€é”€

ç¡¬ä»¶åˆæˆé™åˆ¶:
- Overlay æ•°é‡æœ‰é™ (é€šå¸¸ 4-8 ä¸ª)
- ä¸æ”¯æŒå¤æ‚å˜æ¢ (å¦‚ 3D æ—‹è½¬)
- æŸäº›æ··åˆæ¨¡å¼ä¸æ”¯æŒ
```

#### âŒ è¯¯è§£: "VSync åªæœ‰ä¸€ä¸ª"
#### âœ… äº‹å®: Android æœ‰å¤šä¸ª VSync ä¿¡å·
```
VSYNC-app:    åº”ç”¨å±‚å¼€å§‹æ¸²æŸ“çš„ä¿¡å· (Choreographer æ¥æ”¶)
VSYNC-sf:     SurfaceFlinger å¼€å§‹åˆæˆçš„ä¿¡å·
VSYNC-display: å®é™…å±å¹•åˆ·æ–°ä¿¡å·

åç§»å…³ç³» (å¯é…ç½®):
VSYNC-app é€šå¸¸æ¯” VSYNC-sf æ—© 1-2ms
ç›®çš„: è®© App æœ‰æ—¶é—´åœ¨ SF åˆæˆå‰å®Œæˆæ¸²æŸ“
```

### 4. SurfaceTexture ç›¸å…³

#### âŒ è¯¯è§£: "SurfaceTexture ä½¿ç”¨æ™®é€š 2D çº¹ç†"
#### âœ… äº‹å®: å¿…é¡»ä½¿ç”¨ GL_TEXTURE_EXTERNAL_OES
```glsl
// é”™è¯¯: ä½¿ç”¨ sampler2D
uniform sampler2D uTexture;

// æ­£ç¡®: å¿…é¡»ä½¿ç”¨ samplerExternalOES
#extension GL_OES_EGL_image_external : require
uniform samplerExternalOES uTexture;
```

åŸå› : 
- å¤–éƒ¨çº¹ç†å¯èƒ½æ˜¯ YUV æ ¼å¼
- çº¹ç†æ•°æ®å¯èƒ½ä¸åœ¨ GPU å†…å­˜ä¸­
- éœ€è¦ç‰¹æ®Šçš„é‡‡æ ·è·¯å¾„

#### âŒ è¯¯è§£: "updateTexImage() ä¼šé˜»å¡ç­‰å¾…æ–°å¸§"
#### âœ… äº‹å®: updateTexImage() æ˜¯éé˜»å¡çš„
```java
// updateTexImage() ç«‹å³è¿”å›:
// - å¦‚æœæœ‰æ–°å¸§ï¼Œæ›´æ–°çº¹ç†
// - å¦‚æœæ²¡æœ‰æ–°å¸§ï¼Œçº¹ç†ä¿æŒä¸å˜

// æ£€æŸ¥æ˜¯å¦æœ‰æ–°å¸§å¯ç”¨:
surfaceTexture.setOnFrameAvailableListener(listener);
```

### 5. Vulkan ç›¸å…³

#### âŒ è¯¯è§£: "Vulkan æ¯” OpenGL ES æ›´å¿«"
#### âœ… äº‹å®: Vulkan çš„ä¼˜åŠ¿åœ¨äºå¯é¢„æµ‹æ€§å’Œ CPU å¼€é”€ï¼Œä¸æ˜¯ç»å¯¹é€Ÿåº¦
```
Vulkan çœŸæ­£ä¼˜åŠ¿:
- CPU ç«¯é©±åŠ¨å¼€é”€æ›´ä½ (é¢„ç¼–è¯‘ Pipeline)
- å¤šçº¿ç¨‹å‘½ä»¤å½•åˆ¶
- æ˜¾å¼å†…å­˜ç®¡ç†ï¼Œå‡å°‘è¿è¡Œæ—¶åˆ†é…
- æ›´å¥½çš„å¸§æ—¶é—´ä¸€è‡´æ€§

ä½†:
- ç®€å•åœºæ™¯ä¸‹ GLES å¯èƒ½æ›´å¿«
- Vulkan åˆå§‹åŒ–å¼€é”€å¤§
- ä»£ç å¤æ‚åº¦é«˜ 5-10 å€
```

#### âŒ è¯¯è§£: "Vulkan ä¸éœ€è¦åŒæ­¥ï¼ŒGPU ä¼šè‡ªåŠ¨å¤„ç†"
#### âœ… äº‹å®: Vulkan çš„åŒæ­¥å®Œå…¨ç”±å¼€å‘è€…è´Ÿè´£
```cpp
// å¸¸è§é”™è¯¯: å¿˜è®°åŒæ­¥å¯¼è‡´çš„é—ªçƒ/æ’•è£‚

// é”™è¯¯: ç›´æ¥æäº¤æ–°å‘½ä»¤
vkQueueSubmit(queue, 1, &submitInfo, VK_NULL_HANDLE);

// æ­£ç¡®: ä½¿ç”¨ Fence ç­‰å¾…å‰ä¸€å¸§å®Œæˆ
vkWaitForFences(device, 1, &frameFence, VK_TRUE, UINT64_MAX);
vkResetFences(device, 1, &frameFence);
vkQueueSubmit(queue, 1, &submitInfo, frameFence);
```

### 6. ç¡¬ä»¶åŠ é€Ÿç›¸å…³

#### âŒ è¯¯è§£: "å¼€å¯ç¡¬ä»¶åŠ é€Ÿåæ‰€æœ‰ View éƒ½ä¼šç”¨ GPU æ¸²æŸ“"
#### âœ… äº‹å®: æŸäº›æ“ä½œä¼š fallback åˆ°è½¯ä»¶æ¸²æŸ“
```java
// ä»¥ä¸‹æ“ä½œä¼šå¯¼è‡´è½¯ä»¶æ¸²æŸ“:
// - Canvas.drawBitmapMesh()
// - Paint.setMaskFilter() (éƒ¨åˆ†)
// - æŸäº› PorterDuff æ¨¡å¼

// æ£€æŸ¥ View æ˜¯å¦ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿ:
boolean hwAccel = myView.isHardwareAccelerated();

// æ£€æŸ¥ Canvas æ˜¯å¦ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿ:
boolean canvasHwAccel = canvas.isHardwareAccelerated();
```

#### âŒ è¯¯è§£: "LAYER_TYPE_HARDWARE æ€»æ˜¯èƒ½æå‡æ€§èƒ½"
#### âœ… äº‹å®: ä¸å½“ä½¿ç”¨ä¼šå¢åŠ å†…å­˜å ç”¨å’Œåˆæˆå¼€é”€
```java
// é€‚åˆä½¿ç”¨ç¡¬ä»¶ Layer çš„åœºæ™¯:
// - View å†…å®¹å¤æ‚ä½†å˜åŒ–é¢‘ç‡ä½
// - éœ€è¦å¯¹æ•´ä¸ª View åº”ç”¨åŠ¨ç”» (alpha/translation/scale/rotation)

// ä¸é€‚åˆçš„åœºæ™¯:
// - View å†…å®¹é¢‘ç¹å˜åŒ–
// - å°å‹ç®€å• View

// ä½¿ç”¨åè®°å¾—åŠæ—¶æ¸…é™¤:
view.setLayerType(View.LAYER_TYPE_HARDWARE, null);
// åŠ¨ç”»ç»“æŸå
view.setLayerType(View.LAYER_TYPE_NONE, null);
```

---

## ğŸ“š æ ¸å¿ƒæºç é˜…è¯»æ¸…å•

æŒ‰ä¼˜å…ˆçº§æ’åº:

| ä¼˜å…ˆçº§ | æºç è·¯å¾„ | æ ¸å¿ƒå†…å®¹ |
|--------|----------|----------|
| 1 | `frameworks/native/libs/gui/Surface.cpp` | ANativeWindow å®ç° |
| 2 | `frameworks/native/libs/gui/BufferQueue*.cpp` | BufferQueue æ ¸å¿ƒ |
| 3 | `frameworks/native/opengl/libs/EGL/` | EGL wrapper |
| 4 | `frameworks/native/services/surfaceflinger/SurfaceFlinger.cpp` | SF ä¸»ç±» |
| 5 | `frameworks/native/services/surfaceflinger/Layer.cpp` | Layer ç®¡ç† |
| 6 | `frameworks/native/services/surfaceflinger/CompositionEngine/` | åˆæˆå¼•æ“ |
| 7 | `frameworks/base/libs/hwui/` | ç¡¬ä»¶åŠ é€Ÿ UI |
| 8 | `frameworks/base/graphics/java/android/graphics/SurfaceTexture.java` | Java å±‚ |

---

## ğŸ¯ é‡Œç¨‹ç¢‘æ£€æŸ¥æ¸…å•

### Month 2 æ£€æŸ¥ç‚¹
- [ ] èƒ½æ‰‹å†™ EGL åˆå§‹åŒ–ä»£ç ï¼ˆä¸æŸ¥æ–‡æ¡£ï¼‰
- [ ] ç†è§£ä¸ºä»€ä¹ˆ Context å¿…é¡»ç»‘å®šçº¿ç¨‹
- [ ] èƒ½è§£é‡Š EGLImage çš„ç”¨é€”

### Month 4 æ£€æŸ¥ç‚¹
- [ ] èƒ½ç”»å‡º BufferQueue çŠ¶æ€è½¬æ¢å›¾
- [ ] èƒ½è§£é‡Š SurfaceTexture å’Œæ™®é€šçº¹ç†çš„åŒºåˆ«
- [ ] ç†è§£ Fence çš„ä½œç”¨

### Month 7 æ£€æŸ¥ç‚¹
- [ ] èƒ½ä½¿ç”¨ Perfetto åˆ†æå¸§è€—æ—¶
- [ ] ç†è§£ HWC åˆæˆç­–ç•¥å†³ç­–è¿‡ç¨‹
- [ ] èƒ½è§£é‡Š VSync ä¿¡å·çš„åˆ†å‘æœºåˆ¶

### Month 9 æ£€æŸ¥ç‚¹
- [ ] ç†è§£ DisplayList å½•åˆ¶ä¸å›æ”¾
- [ ] èƒ½åˆ†æè¿‡åº¦ç»˜åˆ¶é—®é¢˜
- [ ] ç†è§£ Skia åœ¨ Android ä¸­çš„è§’è‰²

### Month 11 æ£€æŸ¥ç‚¹
- [ ] èƒ½ç‹¬ç«‹å®Œæˆ Vulkan ä¸‰è§’å½¢æ¸²æŸ“
- [ ] ç†è§£ Vulkan åŒæ­¥åŸè¯­çš„ä½¿ç”¨åœºæ™¯
- [ ] èƒ½å¯¹æ¯” GLES å’Œ Vulkan çš„ä¼˜ç¼ºç‚¹

### Month 12 æ£€æŸ¥ç‚¹
- [ ] å®Œæˆè‡³å°‘ä¸€ä¸ªç»¼åˆå®éªŒé¡¹ç›®
- [ ] èƒ½ä½¿ç”¨ GPU è°ƒè¯•å·¥å…·åˆ†ææ€§èƒ½ç“¶é¢ˆ
- [ ] èƒ½å›ç­”æœ¬æ–‡æ¡£ä¸­çš„æ‰€æœ‰"åç›´è§‰ç‚¹"

---

## ğŸ“– æ¨èå­¦ä¹ èµ„æºæ±‡æ€»

### å®˜æ–¹æ–‡æ¡£
- [Android Graphics Architecture](https://source.android.com/docs/core/graphics)
- [Vulkan Specification](https://registry.khronos.org/vulkan/)
- [OpenGL ES Specification](https://registry.khronos.org/OpenGL/)
- [EGL Specification](https://registry.khronos.org/EGL/)

### ä¹¦ç±
- ã€ŠOpenGL ES 3.0 Programming Guideã€‹
- ã€ŠVulkan Programming Guideã€‹
- ã€ŠReal-Time Rendering, 4th Editionã€‹

### åšå®¢/æ–‡ç« 
- [Gityuan - Android å›¾å½¢ç³»ç»Ÿ](http://gityuan.com/)
- [Weishu - Android æ’ä»¶åŒ–ç³»åˆ—](https://weishu.me/)
- [Android Developers Blog - Graphics](https://android-developers.googleblog.com/)

### è§†é¢‘
- Google I/O Graphics Sessions
- Android Dev Summit Rendering Talks
- Khronos Group Vulkan Tutorials

### å·¥å…·
- Android Studio Profiler
- Perfetto (ui.perfetto.dev)
- Android GPU Inspector
- RenderDoc

---

> ğŸ’¡ **å­¦ä¹ å»ºè®®**: 
> 1. æ¯ä¸ªé˜¶æ®µéƒ½è¦åŠ¨æ‰‹å®éªŒï¼Œå…‰çœ‹æ–‡æ¡£æ•ˆæœæœ‰é™
> 2. é˜…è¯» AOSP æºç æ—¶é…åˆ `adb shell dumpsys` å®æ—¶è§‚å¯Ÿ
> 3. é‡åˆ°é—®é¢˜å…ˆæŸ¥ AOSP æºç ï¼Œæ¯” Google æ›´å‡†ç¡®
> 4. åŠ å…¥ Android Graphics ç›¸å…³æŠ€æœ¯ç¾¤ç»„è®¨è®º

ç¥å­¦ä¹ é¡ºåˆ©ï¼ğŸš€

