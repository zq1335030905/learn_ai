# 学习路线图 (Roadmap)

## 愿景 (Vision)

**一年内系统掌握 Android 图形系统、SurfaceFlinger、EGL、OpenGL ES/Vulkan 渲染管线。**

---

## 当前进度概览

| Phase | 状态 | 完成度 | 时间范围 |
|-------|------|--------|----------|
| Phase 1: EGL 基础 | 🔄 进行中 | 0% | Month 1-2 |
| Phase 2: BufferQueue 与 Surface | ⏳ 待开始 | 0% | Month 3-4 |
| Phase 3: SurfaceFlinger 深入 | ⏳ 待开始 | 0% | Month 5-7 |
| Phase 4: 硬件加速与 HWUI | ⏳ 待开始 | 0% | Month 8-9 |
| Phase 5: Vulkan 渲染管线 | ⏳ 待开始 | 0% | Month 10-11 |
| Phase 6: 综合实践 | ⏳ 待开始 | 0% | Month 12 |

**概念级详细进度**：→ `knowledge-base/foundations/graphics-concept-map.md`

**最近更新**：2026-01-07

---

## 知识依赖关系图

```
                    ┌─────────────────────────────────────────────────────────┐
                    │                    应用层 (Application)                  │
                    │  Canvas API / View System / SurfaceView / TextureView   │
                    └─────────────────────────────────────────────────────────┘
                                              │
                                              ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           图形 API 层 (Graphics API)                            │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────────────────┐ │
│  │   OpenGL ES     │    │     Vulkan      │    │      Skia (2D渲染引擎)       │ │
│  │  (状态机模型)    │    │  (显式控制模型)  │    │   (Canvas底层实现/HWUI)      │ │
│  └────────┬────────┘    └────────┬────────┘    └──────────────┬──────────────┘ │
└───────────┼─────────────────────┼────────────────────────────┼─────────────────┘
            │                     │                            │
            └──────────┬──────────┴────────────────────────────┘
                       ▼
        ┌─────────────────────────────────────┐
        │            EGL (桥接层)              │
        │   连接渲染API与原生窗口系统的接口     │
        │   EGLDisplay / EGLSurface / EGLContext│
        └─────────────────┬───────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                          BufferQueue 机制                                       │
│                    Producer ←──────────→ Consumer                               │
│                (App/Camera)              (SurfaceFlinger)                       │
│                                                                                 │
│   ┌──────────────────────┐              ┌──────────────────────┐                │
│   │   Surface            │              │   SurfaceTexture     │                │
│   │   (native_window)    │              │   (GL纹理消费者)      │                │
│   └──────────────────────┘              └──────────────────────┘                │
└─────────────────────────────────────────────────────────────────────────────────┘
                          │
                          ▼
        ┌─────────────────────────────────────┐
        │         SurfaceFlinger              │
        │   (系统合成器 / 窗口管理核心)         │
        │                                     │
        │   • Layer 管理                      │
        │   • VSync 信号分发                  │
        │   • 合成策略 (GPU/HWC)              │
        └─────────────────┬───────────────────┘
                          │
                          ▼
        ┌─────────────────────────────────────┐
        │    Hardware Composer (HWC)          │
        │    硬件合成器抽象层                   │
        └─────────────────┬───────────────────┘
                          │
                          ▼
        ┌─────────────────────────────────────┐
        │         显示驱动 / GPU 驱动          │
        │         Gralloc / DRM/KMS          │
        └─────────────────────────────────────┘
```

---

## 阶段规划

### Phase 1: EGL 基础与巩固 (Month 1-2) 🔄

**完成标准 (Definition of Done)**：

| 指标 | 要求 | 当前 | 状态 |
|------|------|------|------|
| 核心概念掌握 | EGLDisplay/Surface/Context/Config | 0/4 | ⏳ |
| 知识库条目 | ≥1 篇 | 0 | ⏳ |
| 最小实验 | ≥1 个 | 0 | ⏳ |
| Mastery 证据 | egl.md ✅ | ⏳ | ⏳ |

**核心概念**：

| 概念 | 描述 | 重要程度 | 状态 |
|------|------|----------|------|
| EGLDisplay | 与物理显示设备的连接抽象 | ⭐⭐⭐⭐⭐ | ⏳ |
| EGLSurface | 渲染目标表面（窗口/离屏/Pixmap） | ⭐⭐⭐⭐⭐ | ⏳ |
| EGLContext | OpenGL ES 状态机容器 | ⭐⭐⭐⭐⭐ | ⏳ |
| EGLConfig | 帧缓冲配置 | ⭐⭐⭐⭐ | ⏳ |
| EGLImage | 跨进程/跨API共享图像资源 | ⭐⭐⭐⭐ | ⏳ |

**学习目标**：
- [ ] 理解 EGL 作为"桥接层"的角色定位
- [ ] 掌握 EGL 初始化完整流程
- [ ] 理解 EGLContext 与线程绑定机制
- [ ] 掌握多 Context 资源共享（shareContext）
- [ ] 理解 EGLImage 的跨进程共享机制

---

### Phase 2: BufferQueue 与 Surface 体系 (Month 3-4) ⏳

**核心概念**：

| 概念 | 描述 | 重要程度 | 状态 |
|------|------|----------|------|
| BufferQueue | 生产者-消费者模型的缓冲区队列 | ⭐⭐⭐⭐⭐ | ⏳ |
| GraphicBuffer | 跨进程共享的图形缓冲区 | ⭐⭐⭐⭐⭐ | ⏳ |
| ANativeWindow | native 层窗口抽象接口 | ⭐⭐⭐⭐⭐ | ⏳ |
| Surface | ANativeWindow 的 Java/Native 实现 | ⭐⭐⭐⭐⭐ | ⏳ |
| SurfaceTexture | 将 Surface 内容转为 GL 纹理 | ⭐⭐⭐⭐⭐ | ⏳ |
| Fence | 同步原语（GPU/CPU同步） | ⭐⭐⭐⭐ | ⏳ |

**学习目标**：
- [ ] 理解 BufferQueue 的生产者-消费者模型
- [ ] 掌握 GraphicBuffer 的内存管理和跨进程共享
- [ ] 理解 Surface 与 ANativeWindow 的关系
- [ ] 掌握 SurfaceTexture 的工作原理
- [ ] 理解 Fence 同步机制

---

### Phase 3: SurfaceFlinger 深入 (Month 5-7) ⏳

**核心概念**：

| 概念 | 描述 | 重要程度 | 状态 |
|------|------|----------|------|
| SurfaceFlinger | 系统合成服务 | ⭐⭐⭐⭐⭐ | ⏳ |
| Layer | 合成层抽象 | ⭐⭐⭐⭐⭐ | ⏳ |
| VSync | 垂直同步信号 | ⭐⭐⭐⭐⭐ | ⏳ |
| HWC | 硬件合成器 HAL | ⭐⭐⭐⭐⭐ | ⏳ |
| Transaction | 原子提交机制 | ⭐⭐⭐⭐ | ⏳ |

**学习目标**：
- [ ] 理解 SurfaceFlinger 的进程架构和线程模型
- [ ] 掌握 Layer 的类型和管理
- [ ] 理解 VSync 信号的产生和分发机制
- [ ] 掌握 HWC 合成策略
- [ ] 掌握帧调度与 Jank 分析方法

---

### Phase 4: 硬件加速与 HWUI (Month 8-9) ⏳

**核心概念**：

| 概念 | 描述 | 重要程度 | 状态 |
|------|------|----------|------|
| HWUI | 硬件加速 UI 渲染库 | ⭐⭐⭐⭐⭐ | ⏳ |
| RenderThread | UI 渲染专用线程 | ⭐⭐⭐⭐⭐ | ⏳ |
| DisplayList | 渲染命令记录 | ⭐⭐⭐⭐ | ⏳ |
| Skia | 2D 图形引擎 | ⭐⭐⭐⭐⭐ | ⏳ |

**学习目标**：
- [ ] 理解软件渲染与硬件加速渲染的区别
- [ ] 掌握 DisplayList 的录制与回放机制
- [ ] 理解 RenderThread 的职责和生命周期
- [ ] 掌握 Skia 的架构和 GPU 后端选择

---

### Phase 5: Vulkan 渲染管线 (Month 10-11) ⏳

**核心概念**：

| 概念 | 描述 | 重要程度 | 状态 |
|------|------|----------|------|
| VkInstance/VkDevice | Vulkan 实例和设备 | ⭐⭐⭐⭐⭐ | ⏳ |
| VkSwapchain | 交换链 | ⭐⭐⭐⭐⭐ | ⏳ |
| VkRenderPass | 渲染通道 | ⭐⭐⭐⭐⭐ | ⏳ |
| VkPipeline | 图形管线状态对象 | ⭐⭐⭐⭐⭐ | ⏳ |
| Synchronization | 信号量/栅栏 | ⭐⭐⭐⭐⭐ | ⏳ |

**学习目标**：
- [ ] 理解 Vulkan 的设计哲学（显式 vs 隐式）
- [ ] 掌握 Vulkan 初始化流程
- [ ] 理解 RenderPass 和 Subpass 的概念
- [ ] 掌握同步原语的正确使用

---

### Phase 6: 综合实践与性能优化 (Month 12) ⏳

**目标**：
- [ ] 完成至少一个综合实验项目
- [ ] 能使用 GPU 调试工具分析性能瓶颈
- [ ] 能回答所有"反直觉点"

---

## 里程碑检查清单

### Month 2 检查点
- [ ] 能手写 EGL 初始化代码（不查文档）
- [ ] 理解为什么 Context 必须绑定线程
- [ ] 能解释 EGLImage 的用途

### Month 4 检查点
- [ ] 能画出 BufferQueue 状态转换图
- [ ] 能解释 SurfaceTexture 和普通纹理的区别
- [ ] 理解 Fence 的作用

### Month 7 检查点
- [ ] 能使用 Perfetto 分析帧耗时
- [ ] 理解 HWC 合成策略决策过程
- [ ] 能解释 VSync 信号的分发机制

### Month 9 检查点
- [ ] 理解 DisplayList 录制与回放
- [ ] 能分析过度绘制问题
- [ ] 理解 Skia 在 Android 中的角色

### Month 11 检查点
- [ ] 能独立完成 Vulkan 三角形渲染
- [ ] 理解 Vulkan 同步原语的使用场景
- [ ] 能对比 GLES 和 Vulkan 的优缺点

---

## 相关文件

| 文件 | 用途 |
|------|------|
| `knowledge-base/foundations/graphics-concept-map.md` | 概念级学习进度 |
| `SESSION_STATE.md` | 会话断点 |
| `learning-log/` | 每日学习记录 |
| `ROADMAP.md` | 原始详细路线图（含代码示例） |

